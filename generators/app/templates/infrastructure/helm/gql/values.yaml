# Default values for tasks-gql.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
global:

  imagePullSecrets:
  - name: "registrykey"

<%_ if(addVaultConfigs){ _%>
  vaultEnvironment: "false"

#default values
  vaultConfigs:
    sa: "sa"
    role: "role"
    secret: "secret"
    key: key
<%_}_%>

  runtimeConfiguration:
    enabled: false
    configMap: <%= helmChartName %>-runtime-config
    csi:
      secretProviderClass: <%= helmChartName %>-runtime-secrets

<%_ if(addTracing){ _%>
  jaeger:
    enabled: true
    agentAutoInject: false
    agentHost: localhost
    agentPort: 6832
    agentImageTag: 1.16.0
    collectorHost: "[COLECTOR_SERVICE_NAME].[NAMESPACE]"
    collectorPort: 14267
    serviceName: <%= projectName %>
    samplerType: const
    samplerParam: 1
<%_}_%>
<%_ if(addMessaging) { _%>
  messaging:
    env: <%= projectName %>
    topicPrefix: <%= projectName %>.
<%_ if(messagingTransport == 'nats') { _%>
    natsUrl: "nats://[SERVICE].[NAMESPACE]:[PORT]"
    natsCluster: "[CLUSTER_NAME]"
    natsDurableName: durable
<%_}_%>
<%_ if(messagingTransport == 'rusi') { _%>
    rusiPubSubName: "[RUSI_PUBSUB_COMPONENT_NAME]"
    rusiConfigName: "[RUSI_CONFIG_NAME]"
<%_}_%>
<%_}_%>
  db:
    host: "[DB_HOST]"
    database: "[DB_NAME]"
    port: 0 # [DB_PORT] here
    user: "[DB_USER]"
    password: "[DB_PASSWORD]"
    instanceName: ""
    trustServerCertificate: "false"

gql:
  enabled: true
  replicaCount: 1
  name: "<%= helmChartName %>"
  image:
    repository: "[ORGANIZATION].azurecr.io/"
    pullPolicy: IfNotPresent
    name: <%= helmChartName %>
    tag: latest # overwrite from pipeline

  service:
    type: ClusterIP
    port: 80
    targetPort: 4000

  resources:
    limits:
      memory: 512Mi
<%_ if(addMessaging) { _%>
  messaging:
    source: <%= projectName %>
<%_ if(messagingTransport == 'nats') { _%>
    clientId: <%= projectName %>
    natsQGroup: <%= projectName %>
<%_}_%>
<%_}_%>

  # Additional environment variables
  env:
<%_ if(addSubscriptions) { _%>
    REDIS_DOMAIN_NAME: ""
    REDIS_PORT_NUMBER: ""
<%_}_%>
    IDENTITY_API_URL: "[IDENTITY_API_URI]"
    IDENTITY_AUTHORITY: "[IDENTITY_AUTHORITY_URL]"
<%_ if(addGqlLogging){ _%>
    APOLLO_LOGGING_LEVEL: "DEBUG"
<%_}_%>
<%_ if(withMultiTenancy){ _%>
    IS_MULTITENANT: "false"
<%_}_%>
    KNEX_LOGGING: "true"
    PORT: "4000"
    #
